{% extends "base.html" %}
{% load humanize %}

{% block title %}Faction Info{% endblock %}

{% block tutorial %}
{% include "maingame/tutorial_text.html" with page="faction_info" %}
{% endblock %}

{% block content %}
<div>
    <div class="u-flex u-flex-wrap u-gap-4">
        {% for faction_dict in factions %}
        <div class="card card_colors p-1 max-w-xs p-2">
            <h6>{{ faction_dict.faction.name|title }}</h6>
            <table class="table striped card_colors">
                <tr>
                    <th>Name</th>
                    <th>Pwr</th>
                    <th>Upkeep</th>
                    <th>Cost</th>
                </tr>
                {% for unit in faction_dict.units %}
                <tr>
                    {% include "maingame/components/unit_name_row.html" %}
                    <td class="u-align-middle" style="white-space:nowrap">{{ unit.op|intcomma }} / {{ unit.dp|intcomma }}</td>
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            {% for resource, amount in unit.upkeep_dict.items %}
                            <span>{{ amount|intcomma }} {{ resource }}</span>
                            {% endfor %}
                        </div>
                    </td>
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            {% for resource, amount in unit.cost_dict.items %}
                            <span>{{ amount|intcomma }} {{ resource }}</span>
                            {% endfor %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </table>
            <span>{{ faction_dict.faction.description }}</span>
        </div>
        {% endfor %}
    </div>
    <div class="u-flex u-flex-column u-gap-8 pt-8">
        {% for faction_dict in factions %}
            <div class="u-flex u-flex-column u-gap-2">
                <div class="max-w-lg">
                    <h4 class="u-center">{{ faction_dict.faction.name|title }}</h4>
                </div>
                <div class="u-flex u-flex-wrap u-gap-2">
                    {% for discovery in faction_dict.discoveries %}
                        <div class="card card_colors p-1 w-100p max-w-xs">
                            <h6>{{ discovery.name }} (requires {{ discovery_dict.requirement_string }})</h6>
                            <p class="text-xs">{{ discovery.description }}</p>

                            {% if discovery.associated_unit_name %}
                            <details class="px-1 py-0 accordion u-none-md">
                                <summary class="accordion__summary text-xs">Unit info</summary>
                                {% include "maingame/components/discovery_unit_card.html" with unit=discovery.associated_unit %}
                                {% if discovery.associated_unit.has_perks %}
                                <span class="u-none-md">{{ discovery.associated_unit.perk_text }}</span>
                                {% endif %}
                            </details>

                            <div class="u-none u-block-md">
                                {% include "maingame/components/discovery_unit_card.html" with unit=discovery.associated_unit %}
                                {% if discovery.associated_unit.has_perks %}
                                <span class="u-none-md">{{ discovery.associated_unit.perk_text }}</span>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
