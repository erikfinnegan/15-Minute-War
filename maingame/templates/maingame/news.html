{% extends "base.html" %}
{% load extra_tags %}
{% load tz %}

{% block title %}News{% endblock %}

{% block content %}
<div class="">
    {% if active_player.show_tutorials %}
        <p>
            Shows significant events in the round, primarily invasions and players signing up.
        </p>
    {% endif %}
    <table class="table striped max-w-md">
        <tbody>
            {% for event in displayed_events %}
            <tr class="{% if event.involves_player %}text-yellow-300{% endif %}">
                <th class="u-align-middle">{{ event.event.timestamp|timezone:active_player.timezone }}</th>
                <th class="u-align-middle">{{ event.event.icon }}</th>
                <th class="u-align-middle">{{ event.event }}</th>
                <th class="u-align-middle">
                    {% if event.event.reference_type == "battle" %}
                    <a href="{% url 'battle_report' event.event.reference_id %}">
                        <button class="py-0">Info</button>
                    </a>
                    {% else %}
                    {{ event.event.extra_text }}
                    {% endif %}
                </th>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<form action="{% url 'set_timezone' %}" method="post" class="u-flex u-flex-row h-8 mb-8 u-gap-4 max-w-md w-64 w-auto-md">
    {% csrf_token %}
    <h6 class="my-auto">Set timezone</h6>
    <div class="max-w-md u-flex-grow-1 my-auto">
        <select id="tom-select-it" name="timezone">
            {% for timezone in timezones %}
            <option {% if timezone == active_player.timezone %}selected{% endif %}>{{ timezone }}</option>
            {% endfor %}
        </select>
    </div>
    <button class="btn-light my-auto w-16 h-5 p-0" type="submit">
        <span class="font-bold">Submit</span>
    </button>
</form>

<script>
    var config = {
        sortField: {
        field: "text",
        direction: "asc"
    }
    };
    new TomSelect('#tom-select-it', config);
</script>

{% endblock %}
