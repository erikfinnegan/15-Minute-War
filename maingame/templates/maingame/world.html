{% extends "base.html" %}
{% load humanize %}
{% load extra_tags %}

{% block title %}The World{% endblock %}

{% block tutorial %}
{% include "maingame/tutorial_text.html" with page="world" %}
{% endblock %}

{% block content %}
<div>
    <details class="accordion card card_colors max-w-md">
        <summary class="accordion__summary">Details</summary>
            <p>
                These are all the dominions at the moment. When someone makes an invasion, the units they send take 12 ticks to return home, leaving 
                them more vulnerable to attack in the meantime.
            </p>
    </details>

    <div class="u-overflow-x-scroll u-overflow-x-auto-md pr-2 max-w-md">
        <table class="table striped max-w-md">
            <thead>
                <tr class="header_colors">
                    <th class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            <span>Dominion</span>
                            <small>Click for overview</small>
                        </div>
                    </th>
                    <th class="u-align-middle">Land</th>
                    <th class="u-align-middle">Defense</th>
                    <th class="u-align-middle">Bonuses</th>
                    <th class="u-align-middle">Highest OP</th>
                    {% if "book_of_grudges" in active_dominion.perk_dict %}
                    <th class="u-align-middle">Grudges</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for dominion in dominions %}
                <tr class="{% if dominion == active_dominion %}font-bold{% endif %}">

                    {% comment %} Dominion {% endcomment %}
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            <a class="font-bold" href="{% url 'overview' dominion.id %}">{{ dominion.name }}</a>
                            <a href="{% url 'overview' dominion.id %}"><small class="{% if dominion == active_dominion %}font-bold{% endif %}">{{ dominion.rulers_display_name }}</small></a>
                            <a href="{% url 'overview' dominion.id %}"><small class="{% if dominion == active_dominion %}font-bold{% endif %}">{{ dominion.faction_name|title }}</small></a>
                        </div>
                    </td>

                    {% comment %} Land {% endcomment %}
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            <span>{{ dominion.acres|intcomma }}</span>
                            <small>{% if dominion.incoming_acres > 0 %}({{ dominion.incoming_acres|intcomma }}){% endif %}</small>
                        </div>
                    </td>

                    {% comment %} Defense {% endcomment %}
                    <td class="u-align-middle">
                        {% if dominion.has_units_returning %}
                        <span class="tag tag--danger py-0 mx-auto text-md">{{ dominion.defense_short }}</span>
                        {% else %}
                        <span class="u-center {% if dominion.protection_ticks_remaining > 0 or not round.has_started %}text-teal-400{% endif %}">
                            {% if dominion.protection_ticks_remaining == 0 and round.has_started %}{{ dominion.defense_short }}{% else %}Magical protection{% endif %}
                        </span>
                        {% endif %}
                    </td>

                    {% comment %} Bonuses {% endcomment %}
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column">
                            <span>+{{ dominion.determination_bonus_percent|floatformat:0 }}% OP</span>
                            <span>-{{ dominion.complacency_penalty_percent|floatformat:0 }}% DP</span>
                        </div>
                    </td>

                    {% comment %} Highest OP {% endcomment %}
                    <td class="u-align-middle">{{ dominion.highest_op_short }}</td>

                    {% comment %} Grudges {% endcomment %}
                    {% if "book_of_grudges" in active_dominion.perk_dict %}
                    {% if dominion.strid in active_dominion.perk_dict.book_of_grudges %}
                    <td class="u-align-middle">
                        <div class="u-flex u-flex-column u-center w-16">
                            <span>{{ active_dominion.perk_dict.book_of_grudges|getattr:dominion.strid|getattr:"pages" }} pages</span>
                            <span>+{{ active_dominion.perk_dict.book_of_grudges|getattr:dominion.strid|getattr:"animosity"|floatformat:"1" }}% OP</span>
                        </div>
                    </td>
                    {% else %}
                    <td class="u-align-middle">None</td>
                    {% endif %}
                    {% endif %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
